<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panen & Hasil - Pendataan Hewan PWA</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="../manifest.json" />
    <meta name="mobile-web-app-capable" content="yes" />`n    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="Pendataan Hewan" />
    <meta name="theme-color" content="#4F46E5" />
    <meta name="description" content="Catat dan kelola panen serta hasil produksi hewan ternak" />

    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/style.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header with Navigation -->
      <div class="header">
        <div class="header-content">
          <div class="header-title">
            <h1>ğŸ¾ Pendataan Hewan</h1>
            <p>Panen & Hasil Produksi</p>
          </div>
          <div class="header-actions">
            <button class="btn-menu" onclick="toggleMobileMenu()">â˜°</button>
            <a href="profil.html" class="btn btn-info">ğŸ‘¤ Profil</a>
            <a href="../index.html" class="btn btn-secondary">ğŸ  Home</a>
          </div>
        </div>
      </div>

      <!-- Main Navigation -->
      <nav class="main-nav">
        <div class="nav-container">
          <a href="dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
          <a href="pendataan.html" class="nav-link">ğŸ“ Pendataan</a>
          <a href="perawatan.html" class="nav-link">ğŸ¥ Perawatan</a>
          <a href="monitoring.html" class="nav-link">ğŸ“ˆ Monitoring</a>
          <a href="panen.html" class="nav-link active">ğŸŒ¾ Panen</a>
          <a href="evaluasi.html" class="nav-link">ğŸ“‹ Evaluasi</a>
          <a href="search.html" class="nav-link">ğŸ” Pencarian</a>
          <a href="list.html" class="nav-link">ğŸ“„ Daftar</a>
          <a href="profil.html" class="nav-link">ğŸ‘¤ Profil</a>
        </div>
      </nav>

      <!-- Mobile Navigation -->
      <nav class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-content">
          <a href="dashboard.html" class="mobile-nav-link">ğŸ“Š Dashboard</a>
          <a href="pendataan.html" class="mobile-nav-link">ğŸ“ Pendataan</a>
          <a href="perawatan.html" class="mobile-nav-link">ğŸ¥ Perawatan</a>
          <a href="monitoring.html" class="mobile-nav-link">ğŸ“ˆ Monitoring</a>
          <a href="panen.html" class="mobile-nav-link active">ğŸŒ¾ Panen</a>
          <a href="evaluasi.html" class="mobile-nav-link">ğŸ“‹ Evaluasi</a>
          <a href="search.html" class="mobile-nav-link">ğŸ” Pencarian</a>
          <a href="list.html" class="mobile-nav-link">ğŸ“„ Daftar</a>
          <a href="profil.html" class="mobile-nav-link">ğŸ‘¤ Profil</a>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <div class="module-header">
          <h2>ğŸŒ¾ Panen & Hasil Produksi</h2>
          <p>Catat dan kelola panen serta hasil produksi hewan ternak</p>
        </div>

        <div class="harvest-section">
          <!-- Harvest Tabs -->
          <div class="tabs">
            <button class="tab-button active" onclick="showTab('production')">ğŸ¥› Produksi Harian</button>
            <button class="tab-button" onclick="showTab('harvest')">ğŸŒ¾ Panen/Jual</button>
            <button class="tab-button" onclick="showTab('financial')">ğŸ’° Keuangan</button>
            <button class="tab-button" onclick="showTab('reports')">ğŸ“Š Laporan</button>
          </div>

          <!-- Production Tab -->
          <div id="production" class="tab-content active">
            <h3>ğŸ¥› Catat Produksi Harian</h3>
            
            <form id="productionForm" class="production-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="selectAnimalProduction">Pilih Hewan</label>
                  <select id="selectAnimalProduction" required>
                    <option value="">-- Pilih Hewan --</option>
                    <!-- Will be populated by JavaScript -->
                  </select>
                </div>
                <div class="form-group">
                  <label for="productionDate">Tanggal Produksi</label>
                  <input type="date" id="productionDate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="productType">Jenis Produksi</label>
                  <select id="productType" required>
                    <option value="">-- Pilih Jenis --</option>
                    <option value="susu">ğŸ¥› Susu</option>
                    <option value="telur">ğŸ¥š Telur</option>
                    <option value="daging">ğŸ¥© Daging</option>
                    <option value="wool">ğŸ‘ Wol/Bulu</option>
                    <option value="lainnya">ğŸ”¸ Lainnya</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="productQuantity">Jumlah</label>
                  <input type="number" id="productQuantity" step="0.1" min="0" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="productUnit">Satuan</label>
                  <select id="productUnit" required>
                    <option value="liter">Liter</option>
                    <option value="kg">Kilogram</option>
                    <option value="butir">Butir</option>
                    <option value="potong">Potong</option>
                    <option value="karung">Karung</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="productQuality">Kualitas</label>
                  <select id="productQuality">
                    <option value="A">A - Sangat Baik</option>
                    <option value="B">B - Baik</option>
                    <option value="C">C - Cukup</option>
                    <option value="D">D - Kurang</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="productionNotes">Catatan Produksi</label>
                <textarea id="productionNotes" rows="2" placeholder="Kondisi, metode, dll"></textarea>
              </div>

              <button type="submit" class="btn btn-primary">
                ğŸ’¾ Simpan Data Produksi
              </button>
            </form>

            <!-- Daily Production Summary -->
            <div class="production-summary">
              <h4>ğŸ“Š Ringkasan Produksi Hari Ini</h4>
              <div id="todayProduction" class="production-cards">
                <!-- Today's production will be shown here -->
              </div>
            </div>
          </div>

          <!-- Harvest/Sale Tab -->
          <div id="harvest" class="tab-content">
            <h3>ğŸŒ¾ Catat Panen/Penjualan</h3>
            
            <form id="harvestForm" class="harvest-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="selectAnimalHarvest">Pilih Hewan</label>
                  <select id="selectAnimalHarvest" required>
                    <option value="">-- Pilih Hewan --</option>
                    <!-- Will be populated by JavaScript -->
                  </select>
                </div>
                <div class="form-group">
                  <label for="harvestDate">Tanggal</label>
                  <input type="date" id="harvestDate" required />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="harvestType">Jenis Transaksi</label>
                  <select id="harvestType" required>
                    <option value="">-- Pilih Jenis --</option>
                    <option value="jual_hidup">ğŸ„ Jual Hidup</option>
                    <option value="jual_daging">ğŸ¥© Jual Daging</option>
                    <option value="jual_produk">ğŸ¥› Jual Produk</option>
                    <option value="potong_sendiri">ğŸ”ª Potong Sendiri</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="harvestWeight">Berat (kg)</label>
                  <input type="number" id="harvestWeight" step="0.1" min="0" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="harvestPrice">Harga per Unit</label>
                  <input type="number" id="harvestPrice" step="1000" min="0" />
                </div>
                <div class="form-group">
                  <label for="totalValue">Total Nilai</label>
                  <input type="number" id="totalValue" step="1000" min="0" readonly />
                </div>
              </div>

              <div class="form-group">
                <label for="buyerInfo">Informasi Pembeli</label>
                <textarea id="buyerInfo" rows="2" placeholder="Nama, kontak, alamat pembeli"></textarea>
              </div>

              <button type="submit" class="btn btn-success">
                ğŸ’° Simpan Data Panen/Jual
              </button>
            </form>

            <!-- Recent Sales -->
            <div class="recent-sales">
              <h4>ğŸ’¸ Penjualan Terbaru</h4>
              <div id="recentSales" class="sales-list">
                <!-- Recent sales will be shown here -->
              </div>
            </div>
          </div>

          <!-- Financial Tab -->
          <div id="financial" class="tab-content">
            <h3>ğŸ’° Analisis Keuangan</h3>
            
            <div class="financial-summary">
              <div class="summary-cards">
                <div class="summary-card">
                  <h4>ğŸ’µ Pendapatan Bulan Ini</h4>
                  <div class="summary-value" id="monthlyIncome">Rp 0</div>
                </div>
                <div class="summary-card">
                  <h4>ğŸ’¸ Pengeluaran Bulan Ini</h4>
                  <div class="summary-value" id="monthlyExpense">Rp 0</div>
                </div>
                <div class="summary-card">
                  <h4">ğŸ“ˆ Keuntungan Bersih</h4>
                  <div class="summary-value" id="netProfit">Rp 0</div>
                </div>
              </div>
            </div>

            <div class="financial-chart">
              <h4>ğŸ“Š Grafik Keuangan</h4>
              <canvas id="financialChart" width="400" height="200"></canvas>
            </div>

            <!-- ROI Analysis -->
            <div class="roi-analysis">
              <h4>ğŸ“Š Analisis ROI per Hewan</h4>
              <div id="roiAnalysis" class="roi-cards">
                <!-- ROI analysis will be shown here -->
              </div>
            </div>
          </div>

          <!-- Reports Tab -->
          <div id="reports" class="tab-content">
            <h3>ğŸ“Š Laporan Produksi</h3>
            
            <div class="report-filters">
              <div class="form-row">
                <div class="form-group">
                  <label for="reportPeriod">Periode Laporan</label>
                  <select id="reportPeriod">
                    <option value="weekly">Mingguan</option>
                    <option value="monthly">Bulanan</option>
                    <option value="quarterly">Triwulan</option>
                    <option value="yearly">Tahunan</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="reportType">Jenis Laporan</label>
                  <select id="reportType">
                    <option value="production">Produksi</option>
                    <option value="sales">Penjualan</option>
                    <option value="financial">Keuangan</option>
                    <option value="comprehensive">Komprehensif</option>
                  </select>
                </div>
              </div>
              
              <button class="btn btn-primary" onclick="generateReport()">
                ğŸ“Š Generate Laporan
              </button>
              <button class="btn btn-secondary" onclick="exportReport()">
                ğŸ“¤ Export PDF
              </button>
            </div>

            <div class="report-content">
              <div id="reportResults" class="report-display">
                <!-- Generated report will be shown here -->
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <p>&copy; 2025 Pendataan Hewan PWA. All rights reserved.</p>
      </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/js/error-handler.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/app.js"></script>
    <script>
      // Mobile menu toggle
      function toggleMobileMenu() {
        const mobileNav = document.getElementById('mobileNav');
        if (mobileNav) {
          mobileNav.classList.toggle('active');
        }
      }

      // Tab functionality
      function showTab(tabName) {
        // Hide all tab contents
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(content => content.classList.remove('active'));
        
        // Remove active class from all buttons
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(button => button.classList.remove('active'));
        
        // Show selected tab content
        const selectedTab = document.getElementById(tabName);
        if (selectedTab) {
          selectedTab.classList.add('active');
        }
        
        // Add active class to clicked button
        event.target.classList.add('active');
      }

      // Close mobile menu when clicking outside
      document.addEventListener('click', function(event) {
        const mobileNav = document.getElementById('mobileNav');
        const menuBtn = document.querySelector('.btn-menu');
        
        if (mobileNav && menuBtn && !mobileNav.contains(event.target) && !menuBtn.contains(event.target)) {
          mobileNav.classList.remove('active');
        }
      });

      // Initialize when page loads
      document.addEventListener('DOMContentLoaded', function() {
        // Check authentication
        if (typeof auth !== 'undefined' && !auth.requireAuth()) {
          return; // Will redirect to login if not authenticated
        }
        
        if (typeof loadAnimalsForHarvest === 'function') {
          loadAnimalsForHarvest();
        }
      });
    </script>
  </body>
</html>
